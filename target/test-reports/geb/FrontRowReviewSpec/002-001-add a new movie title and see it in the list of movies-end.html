<html xmlns="http://www.w3.org/1999/xhtml"><head>
<title>Front Row Reviews - Movies</title>
<link type="text/css" href="css/main.css" rel="stylesheet" />
<script src="js/external/jquery-2.0.3.min.js"></script>
<script>
	function addMovieFromFormData() {
		$.ajax({
			type : "GET",
			url : "rest/movie",
			contentType : "application/json",
		}).done(function(response) {
			if(response){
				addToTable(response.movieViewModel);
			}
		});
	}
    
    function addMovieReview(){
 		$.ajax({
			type : "GET",
			url : "rest/review",
			contentType : "application/json",
		}).done(function(response) {
			if(response){
				addToTable(response.movieViewModel);
			}
		});
    }

	function addToTable(data) {
		var table = document.createElement("table");
		table.setAttribute("class", "moviesTable");
		
		if(!data.length){
			addMovie(table,data,{'reviews':[]});
		} else {
			for (var i = 0; i &lt; data.length; i++) {
				var rowData = data[i];
				addMovie(table,rowData,{'reviews':[]});
			}
		}
		$('#tableLocation').append(table);
	}
	
	function addMovie(table, movieDetails, reviewDetails){
		var row = document.createElement("tr");
		
        var cell = document.createElement("td");
		cell.innerHTML = movieDetails.title;
		row.appendChild(cell);
        
		cell = document.createElement("td");
		cell.innerHTML = "&lt;a id='addReview_"+movieDetails.key+
                "' class=\"button\" href=\"javascript:reviewMovie('"+movieDetails.key+
                "')\"&gt;Add Review&lt;/a&gt;";
		row.appendChild(cell);
        
        cell = document.createElement("td");
        
        // extend to different table and reviewer
        var reviews = "";
        for(i =0;i&lt;reviewDetails.reviews.length;i++){
            reviews += reviewDetails.reviews[i].text;
        }
        
		cell.innerHTML = reviews;
		row.appendChild(cell);
        
		table.appendChild(row);
	}
	
	function reviewMovie(key){
		sessionStorage.movieKey=key;
		window.location.href="review_movie.html"
	}
	
</script>

</head>
<body>

	<div id="header-nav"><div class="headerClass">
	<center>
		<img border="0" src="images/frontrow-logo.png" />
	</center>
</div>
<div class="headerLinks">
	<a href="index.html" id="homeNavButton" class="button">Home</a> <a href="list_movies.html" id="listMoviesNavButton" class="button">List
		movies</a> <a href="add_movie.html" id="addMovieNavButton" class="button">Add
		movie</a> <input type="text" placeholder="Enter Email Address" onchange="storeInSession();" id="emailAddress" size="30" class="emailAddressFld" />

	<script>
		if (sessionStorage.emailAddress !== "") {
			$("#emailAddress").val(sessionStorage.emailAddress);
		}

		function storeInSession() {
			sessionStorage.emailAddress = $("#emailAddress").val();

		}
	</script>

</div>
</div>

	<script>
		$("#header-nav").load("/components/header.html");
	</script>
	<div class="contentClass">

		<h2>Movie list:</h2>

		<div id="tableLocation"><table class="moviesTable"><tr><td>Star Trek into darkness</td><td><a href="javascript:reviewMovie('1')" class="button" id="addReview_1">Add Review</a></td><td></td></tr></table></div>
		<script>
			addMovieFromFormData();
		</script>

		<div id="addMovieStatus"></div>
	</div>

</body></html>